const rootLayout=document.getElementById("root"),endpoint=rootLayout.getAttribute("dev")?"http://localhost:8080":"https://pretty.nasuyun.com",clearIcon='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">\n<path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>\n<path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>\n</svg>',starIcon='<span style="margin:0.1rem 0 0 0.1rem"><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 16 16"> <path fill="#e2a400" fill-rule="evenodd" d="M10.472 5.008L16 5.816l-4 3.896.944 5.504L8 12.616l-4.944 2.6L4 9.712 0 5.816l5.528-.808L8 0z"></path> </svg>',emptyPageHtml='\n<div class="hits-empty-state" style="min-width:600px">\n  <svg\n    xmlns="http://www.w3.org/2000/svg"\n    xmlns:xlink="http://www.w3.org/1999/xlink"\n    width="138"\n    height="138"\n    class="hits-empty-state-image"\n  >\n    <defs>\n      <linearGradient id="c" x1="50%" x2="50%" y1="100%" y2="0%">\n        <stop offset="0%" stop-color="#F5F5FA" />\n        <stop offset="100%" stop-color="#FFF" />\n      </linearGradient>\n      <path\n        id="b"\n        d="M68.71 114.25a45.54 45.54 0 1 1 0-91.08 45.54 45.54 0 0 1 0 91.08z"\n      />\n      <filter\n        id="a"\n        width="140.6%"\n        height="140.6%"\n        x="-20.3%"\n        y="-15.9%"\n        filterUnits="objectBoundingBox"\n      >\n        <feOffset dy="4" in="SourceAlpha" result="shadowOffsetOuter1" />\n        <feGaussianBlur\n          in="shadowOffsetOuter1"\n          result="shadowBlurOuter1"\n          stdDeviation="5.5"\n        />\n        <feColorMatrix\n          in="shadowBlurOuter1"\n          result="shadowMatrixOuter1"\n          values="0 0 0 0 0.145098039 0 0 0 0 0.17254902 0 0 0 0 0.380392157 0 0 0 0.15 0"\n        />\n        <feOffset dy="2" in="SourceAlpha" result="shadowOffsetOuter2" />\n        <feGaussianBlur\n          in="shadowOffsetOuter2"\n          result="shadowBlurOuter2"\n          stdDeviation="1.5"\n        />\n        <feColorMatrix\n          in="shadowBlurOuter2"\n          result="shadowMatrixOuter2"\n          values="0 0 0 0 0.364705882 0 0 0 0 0.392156863 0 0 0 0 0.580392157 0 0 0 0.2 0"\n        />\n        <feMerge>\n          <feMergeNode in="shadowMatrixOuter1" />\n          <feMergeNode in="shadowMatrixOuter2" />\n        </feMerge>\n      </filter>\n    </defs>\n    <g fill="none" fill-rule="evenodd">\n      <circle\n        cx="68.85"\n        cy="68.85"\n        r="68.85"\n        fill="#5468FF"\n        opacity=".07"\n      />\n      <circle\n        cx="68.85"\n        cy="68.85"\n        r="52.95"\n        fill="#5468FF"\n        opacity=".08"\n      />\n      <use fill="#000" filter="url(#a)" xlink:href="#b" />\n      <use fill="url(#c)" xlink:href="#b" />\n      <path\n        d="M76.01 75.44c5-5 5.03-13.06.07-18.01a12.73 12.73 0 0 0-18 .07c-5 4.99-5.03 13.05-.07 18a12.73 12.73 0 0 0 18-.06zm2.5 2.5a16.28 16.28 0 0 1-23.02.09A16.29 16.29 0 0 1 55.57 55a16.28 16.28 0 0 1 23.03-.1 16.28 16.28 0 0 1-.08 23.04zm1.08-1.08l-2.15 2.16 8.6 8.6 2.16-2.15-8.6-8.6z"\n        fill="#5369FF"\n      />\n    </g>\n  </svg>\n\n  <p class="hits-empty-state-title">\n    抱歉，无法找到结果。\n  </p>\n  <p class="hits-empty-state-description">\n    请调整过滤项或查询关键词\n  </p>\n</div>\n';Handlebars.registerHelper({list:function(e){return"<ul>\n"+e.map((e=>"<li>"+e+"</li>")).join("\n")+"\n</ul>"},upper:function(e){return Array.isArray(e)?e.map((e=>e.toUpperCase())):"string"==typeof e?e.toUpperCase():e},star:function(e){return`<span class="hit-em hit-rating">${starIcon.repeat(e)}</span>`},repeat:function(e,t){return`${(t=t?.loc?.start?.line?"":t)&&t.repeat(e)||""}`},omit:function(e,t){return"string"==typeof e?e.substring(0,t)+(e.length>t?" ...":""):e},substring:function(e,t){return"string"==typeof e?e.substring(0,t):e},json:function(e){return JSON.stringify(e?.data?.root||{})}}),Handlebars.registerHelper("helperMissing",(function(){var e=arguments[arguments.length-1],t=Array.prototype.slice.call(arguments,0,arguments.length-1);return new Handlebars.SafeString("Missing: "+e.name+"("+t+")")})),Handlebars.registerHelper("blockHelperMissing",(function(e,t){return"Helper '"+t.name+"' not found. Printing block: "+t.fn(e)}));const create=e=>{var t=document.createElement(e.type||"div");return e.class&&(t.className=e.class),e.innerHTML&&(t.innerHTML=e.innerHTML),e.src&&(t.src=e.src),e.id&&t.setAttribute("id",e.id),t},createFilterContainer=()=>{let e=create({type:"div",class:"container-filters"}),t=create({type:"div",id:"clear-filters"}),n=create({type:"div",class:"container-header"}),a=create({innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#000" class="bi bi-filter" viewBox="0 0 16 16">\n        <path d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>\n      </svg>'}),s=create({type:"div",id:"facets",class:"container-body"});n.appendChild(a),n.appendChild(t),e.appendChild(n),e.appendChild(s),document.getElementById("facets-container").appendChild(e)},renderCanvas=e=>{let t=e.searchSettings;const n=e.index;let a=document.getElementById("right-header-container");(t?.sortAttributes?.length>0||t?.pagination?.enabled)&&(a.className="container-header container-options");const s=[];let i;if(t?.sortAttributes?.length>0){i={default:{field:"_score",order:"desc"}};const e=t.sortAttributes.reduce(((e,t)=>({...e,[`_${t.field}_desc`]:{field:t.field,order:"desc"},[`_${t.field}_asc`]:{field:t.field,order:"asc"}})),{});i={...i,...e},t.sortAttributes.map((e=>{const t="_sortby_"+e.field;a.appendChild(create({id:t,class:"container-option"})),s.push(instantsearch.widgets.sortBy({container:"#"+t,items:[{label:e.title,value:n},{label:"从高到低",value:[n,e.field,"desc"].join("_")},{label:"从低到高",value:[n,e.field,"asc"].join("_")}]}))}))}const r=[],l={1:{min:8,middle:16,max:32},2:{min:12,middle:24,max:48},3:{min:12,middle:24,max:48},4:{min:16,middle:32,max:64}},o=e?.styles?.gridMaxColumns&&l[e?.styles?.gridMaxColumns+""]||l[4];if(t?.pagination?.enabled){const e=create({id:"hits-per-page",class:"container-option"});a.appendChild(e);const t=[{label:`每页${o.min}条`,value:o.min,default:!0},{label:`每页${o.middle}条`,value:o.middle},{label:`每页${o.max}条`,value:o.max}];r.push(instantsearch.widgets.hitsPerPage({container:"#hits-per-page",items:t}))}const c=[];var d=[];if(t.facetAttributes&&t.facetAttributes.length>0){createFilterContainer(),d=t.facetAttributes.map((e=>({...e}))),t={...t,facet_attributes:d};const e=document.getElementById("facets");e.classList.add("container-wrapper"),t.facet_attributes?.map((t=>{var n=create({type:"div",class:"ais-Panel ais-Panel--collapsible"}),a=create({type:"div",class:"ais-Panel-header"}),s=create({type:"span",innerHTML:t.title});a.appendChild(s);const i=t.id;var r=create({type:"div",class:"ais-Panel-body",id:i});n.appendChild(a),n.appendChild(r),e.appendChild(n);try{switch(t.widget){case"menu":c.push(instantsearch.widgets.menu({container:"#"+i,attribute:t.attribute,...t.config}));break;case"menuSelect":c.push(instantsearch.widgets.menuSelect({container:"#"+i,attribute:t.attribute,...t.config,templates:{defaultOption:(e,{html:t})=>t`<span>所有的</span>`}}));break;case"numericMenu":try{const e=JSON.parse(t.config.json);c.push(instantsearch.widgets.numericMenu({container:"#"+i,attribute:t.attribute,items:e}))}catch(e){console.error(e)}break;case"rangeSlider":c.push(instantsearch.widgets.rangeSlider({container:"#"+i,attribute:t.attribute,pips:!1,tooltips:!0,...t.config}));break;case"ratingMenu":c.push(instantsearch.widgets.ratingMenu({container:"#"+i,attribute:t.attribute,...t.config}));break;case"rangeInput":c.push(instantsearch.widgets.rangeInput({container:"#"+i,attribute:t.attribute,...t.config}));break;case"toggleRefinement":c.push(instantsearch.widgets.toggleRefinement({container:"#"+i,attribute:t.attribute,...t.config,templates:{labelText:({data:e},{html:n})=>n`<span>${t?.config?.label}</span>`}}));break;default:c.push(instantsearch.widgets.refinementList({container:"#"+i,attribute:t.attribute,...t.config,templates:{showMoreText:"\n                                  {{#isShowingMore}}\n                                    收紧\n                                  {{/isShowingMore}}\n                                  {{^isShowingMore}}\n                                    更多\n                                  {{/isShowingMore}}\n                                  ",searchableNoResults:(e,{html:t})=>t`<span>无结果</span>`}}))}}catch(e){console.error(e)}})),c.push(instantsearch.widgets.clearRefinements({container:"#clear-filters",templates:{resetLabel:({hasRefinements:e},{html:t})=>e?clearIcon:""}}))}const p=new Searchkit({connection:{host:endpoint,apiKey:e.apikey},search_settings:{...t,sorting:i}}),h=instantsearch({indexName:n,searchClient:SearchkitInstantsearchClient(p)}),u="table"==e?.styles?.layout?instantsearch.connectors.connectHits((function(t){const n=t.hits,a=e?.styles?.columns?.map((e=>`<th ${e.width&&"width="+e.width}>${e.label}</th>`)).join(""),s=`<thead><tr>${a}</tr></thead>`,i=n.map((t=>`<tr>${e?.styles?.columns?.map((e=>`<td>${Handlebars.compile(e.html,{noEscape:!0})(t)}</td>`)).join("")}</tr>`)),r=document.createElement("table");r.className="styled-table",r.innerHTML=s+i.join("");const l=document.querySelector("#hits");l.innerHTML="",t?.results&&e?.styles?.columns?.length>0&&(n.length>0?(l.appendChild(r),document.querySelector("#container").style="max-width: max-content"):l.appendChild(create({innerHTML:emptyPageHtml})))}))():instantsearch.widgets.hits({container:"#hits",templates:{item:(t,{html:n,components:a})=>Handlebars.compile(e?.styles?.hitHtml,{noEscape:!0})(t),empty(e){e.getRefinements().length;return emptyPageHtml}}});h.addWidgets([instantsearch.widgets.searchBox({container:"#searchbox",...e?.styles?.searchbox}),...c,...s,...r,u,instantsearch.widgets.pagination({container:"#pagination"})]),h.start()},fr=(e,t)=>{for(var n="",a=0;a<Math.min(e,t);a++)n+="1fr ";return n},renderStyle=e=>{let t="";const n=document.createElement("style");if(e?.styles?.primaryColor){t+=`\n            .header {\n                background: ${e?.styles?.primaryColor}\n            }\n            .header_simple {\n                background: ${e?.styles?.primaryColor}\n            }            \n            .ais-Pagination-item--selected {\n                background-color: ${e?.styles?.primaryColor}\n            }\n            .ais-RangeSlider .rheostat-progress {\n                background-color: ${e?.styles?.primaryColor}\n            }\n            .ais-RefinementList-item--selected .ais-RefinementList-checkbox {\n                background-color: ${e?.styles?.primaryColor}\n            }\n            .ais-RatingMenu-starIcon--full {\n                background-color: ${e?.styles?.primaryColor}\n            }\n            .ais-ToggleRefinement-checkbox:checked {\n                background-color: ${e?.styles?.primaryColor}\n            }\n            `}if(e?.styles?.gridMaxColumns){t+=`\n                @media (min-width: 680px) {\n                    .ais-Hits-list {\n                    grid-template-columns: ${fr(e?.styles?.gridMaxColumns,2)};\n                    }\n                }\n                @media (min-width: 900px) {\n                    .ais-Hits-list {\n                        grid-template-columns: ${fr(e?.styles?.gridMaxColumns,3)};\n                    }\n                }\n                @media (min-width: 1200px) {\n                    .ais-Hits-list {\n                        grid-template-columns: ${fr(e?.styles?.gridMaxColumns,4)};\n                    }\n                }            \n                `}if(e?.styles?.gridBorder){t+=`\n                .ais-Hits {\n                    box-shadow: ${e.styles.gridBorder};\n                    ${"none"!=e.styles.gridBorder&&"padding: 24px;"}  \n                }\n                `}if(e?.styles?.banner){if(e?.styles?.banner?.background)if(e.styles.banner.background.startsWith("http")){t+=`\n                .header {\n                    background-image: url(${e?.styles?.banner?.background});\n                    background-size: cover;\n                }\n                `}else if("standard"==e.styles.banner.background){document.getElementById("header").classList.add("header_"+e.styles.banner.background);t+=" \n                .container-header {\n                    min-height: 40px;\n                }\n                .container-options {\n                    padding: 0;\n                }\n                "}else if("min"==e.styles.banner.background){document.getElementById("header").classList.add("header_min");t+=" \n                .container-header {\n                    min-height: 40px;\n                }\n                .container-options {\n                    padding: 0;\n                }\n                .container {\n                    padding: 1rem 1rem;\n                }"}if(e?.styles?.banner?.slogan_text){let t=document.getElementById("header-title");t.innerHTML=e?.styles?.banner?.slogan_text,e?.styles?.banner?.slogan_color&&(t.style.color=e?.styles?.banner?.slogan_color)}if(e?.styles?.banner?.logo){let t=document.getElementById("header-logo"),n=document.createElement("img");n.src=e?.styles?.banner?.logo,n.style="max-height:64",t.appendChild(n)}}t&&(n.innerHTML=t,document.head.appendChild(n))},renderByConfig=()=>{const e=rootLayout.getAttribute("apikey");"undefined"!=e&&fetch(endpoint+"/api/component",{headers:{apikey:e}}).then((e=>e.json())).then((e=>{renderCanvas(e),renderStyle(e),rootLayout.style.display=""})).catch((e=>rootLayout.appendChild(create({innerHTML:"加载失败"+e}))))};renderByConfig();